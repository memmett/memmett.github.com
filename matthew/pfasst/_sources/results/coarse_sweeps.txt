Effect of multiple SDC sweeps per coarse propagation step
=========================================================

:Author: Matthew Emmett
:Date: February 23 2011

The effect of using a more accurate coarse propagator can be seen by
performing multiple SDC sweeps during each coarse propagation step.

Consider, for example, the viscous Burger's equation given by

.. math::

   u_t + u \nabla u = \nu \nabla^2 u.

This equation is split into explicit and implicit parts according to

.. math::

   \begin{align*}
     f_1 &= -u \, \nabla u \
     f_2 &= \nu \nabla^2 u
   \end{align*}

That is, the non-linear advection term is treated explicitly while the
linear diffusion term is treated implicitly.  To minimize spatial
errors (under-resolved problems will be explored later): periodic
boundary conditions are used, all spatial operators are evaluated
spectrally, and the computational grid is chosen so that the problem
is well-resolved.  The initial condition used throughout is

.. math::

  u_0(x) = \exp( -x^2 / \sigma ).

.. figure:: coarse_sweeps/error_vs_time.png
   :align: center
   :width: 691px
   :alt: Error vs time for various iterations

   Figure 1.  Maximum absolute error vs time for several PFASST
   iterations.  The left and right panels show PFASST errors for one
   and two SDC sweeps per coarse (:math:`\mathcal{G}`) propagation
   step respectively.  Each black line represents the error at the end
   of the corresponding PFASST iteration.  The PFASST simulation is
   comprised of two levels: fine (:math:`\mathcal{F}`) and coarse
   (:math:`\mathcal{G}`).  The red and blue lines represent the error
   of serial runs on the fine and coarse levels with varying numbers
   of SDC sweeps per time step (starting with one sweep for the
   topmost line).  The fine level is: 512 spatial points and 5
   Gauss-Lobatto SDC nodes.  The coarse level is: 256 spatial points
   and 3 Gauss-Lobatto SDC nodes.  The PFASST runs were performed with
   64 processors.  Parameter values used were: :math:`\nu =` 0.005,
   and :math:`\sigma =` 0.004.

Figure 1 shows two important results.  First, that the PFASST
algorithm achieves the accuracy of the fine serial run despite the
relatively poor accuracy of the coarse propagator (the coarse serial
runs stop becoming more accurate after 5 SDC sweeps).  For
well-resolved problems the accuracy of the PFASST algorithm is
determined by the accuracy of the fine level, not the coarse level.

Second, that using two SDC sweeps per coarse propagation step reduces
the number of PFASST iterations needed to obtain a highly accurate
solution from 9 iterations to 4 iterations.  As such, using multiple
SDC sweeps per coarse propagation step accelerates the convergence of
the PFASST method for well-resolved problems and fewer PFASST
iterations are required to achieve high accuracy.  In turn, this
results in a higher parallel speedup.

Using multiple SDC sweeps per fine propagation step does not have a
significant effect on the rate of convergence of the PFASST algorithm.


.. figure:: coarse_sweeps/error_vs_iteration.png
   :align: center
   :width: 673
   :alt: Error vs iteration

   Figure 2.  Maximum absolute error, residual, and change in fine
   initial condition for several PFASST iterations at the final time.
   The left and right panels show PFASST errors, residuals, and change
   in fine initial conditions for one and two SDC sweeps per coarse
   (:math:`\mathcal{G}`) propagation step respectively.  The PFASST
   simulation is comprised of two levels: fine (:math:`\mathcal{F}`)
   and coarse (:math:`\mathcal{G}`).  The red and blue lines represent
   the error of serial runs on the fine and coarse levels with varying
   numbers of SDC sweeps per time step (starting with one sweep for
   the topmost line).  The fine level is: 512 spatial points and 5
   Gauss-Lobatto SDC nodes.  The coarse level is: 256 spatial points
   and 3 Gauss-Lobatto SDC nodes.  The PFASST runs were performed with
   64 processors with a final time of :math:`T_{\rm end} =` 0.04.
   Parameter values used were: :math:`\nu =` 0.005, and :math:`\sigma
   =` 0.004.

Figure 2 shows several interesting features.  First, as was
demonstrated in Figure 1, that the PFASST algorithm achieves the
accuracy of the fine serial run despite the relatively poor accuracy
of the coarse propagator; and that the convergence of the PFASST
algorithm is accelerated by using two SDC sweeps per coarse
propagation step.

Second, that the predictor is more accurate than simply performing
single SDC sweeps in serial.

Third, that for well-resolved problems the residual and change in
initial condition are good indications of the error up to a certain
point.  Using the residual and change in initial condition to
adaptively control the number of iterations used will be explored
later.


.. figure:: coarse_sweeps/error_vs_iteration_proc.png
   :align: center
   :width: 668
   :alt: Error vs iteration for various numbers of processors

   Figure 3.  Maximum absolute error for several PFASST iterations and
   number of processors.  The left panel shows PFASST errors at the
   final time for a fixed final time.  The right panel shows PFASST
   errors at the final time for a fixed time step.  In each panel, the
   fine level is: 512 spatial points and 5 Gauss-Lobatto SDC nodes.
   The coarse level is: 256 spatial points and 3 Gauss-Lobatto SDC
   nodes.  Parameter values used were: :math:`\nu =` 0.005, and
   :math:`\sigma =` 0.004.

Finally, Figure 3 shows how the PFASST algorithm performs for various
numbers of processors.

When the final time is fixed so that increasing the number of
processors used decreases the time step, the overall accuracy of the
PFASST algorithm improves (up to the point where spatial error
dominates) and the number of PFASST iterations required to achieve a
given level of accuracy decreases.

When the time step is fixed so that increasing the number of
processors used extends the solution to later final times, the
convergence is similar for each run regardless of the final time.
That is, for well-resolved problems the convergence depends largely on
the time step used, not on the number of processors.

